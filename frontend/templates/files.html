{% extends "base.html" %}
{% block title %}File Records{% endblock %}

{% block head_extra %}
  <script src="/static/js/common.js"></script>
  <script src="/static/js/upload.js"></script>
  <style>
    /* Drop overlay styles - covers entire page for drag-and-drop anywhere */
    .drop-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(59, 130, 246, 0.15);
      border: 6px dashed #3b82f6;
      z-index: 999;
      pointer-events: none;
      justify-content: center;
      align-items: center;
    }
    .drop-overlay.active {
      display: flex;
      animation: fadeIn 0.2s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .drop-message {
      background-color: white;
      padding: 2rem 3rem;
      border-radius: 0.5rem;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      text-align: center;
      pointer-events: none;
    }
    .drop-message i {
      font-size: 4rem;
      color: #3b82f6;
      margin-bottom: 1rem;
      display: block;
    }
    .drop-message p {
      font-size: 1.5rem;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 0.5rem;
    }
    .drop-message .drop-hint {
      font-size: 1rem;
      color: #6b7280;
      font-weight: 400;
      margin-top: 0.5rem;
    }
    
    /* Upload progress modal */
    .upload-modal {
      display: none;
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      width: 400px;
      max-width: 90vw;
      background-color: white;
      border-radius: 0.5rem;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      overflow: hidden;
    }
    .upload-modal.active {
      display: block;
    }
    .upload-modal-header {
      background-color: #3b82f6;
      color: white;
      padding: 0.75rem 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .upload-modal-body {
      padding: 1rem;
      max-height: 400px;
      overflow-y: auto;
    }
    .close-modal-btn {
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      font-size: 1.25rem;
    }
    .close-modal-btn:hover {
      opacity: 0.8;
    }
    
    <style>
    .file-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
    }
    .file-table th, 
    .file-table td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid #e2e8f0;
    }
    .file-table th {
      background-color: #f7fafc;
      font-weight: 600;
      position: relative;
    }
    .file-table th.sortable {
      cursor: pointer;
      user-select: none;
    }
    .file-table th.sortable:hover {
      background-color: #edf2f7;
    }
    .file-table tbody tr:hover {
      background-color: #f7fafc;
      cursor: pointer;
    }
    .sort-indicator {
      display: inline-block;
      margin-left: 0.5rem;
      opacity: 0.5;
    }
    .sort-indicator.active {
      opacity: 1;
      font-weight: bold;
    }
    
    /* Status badges */
    .status-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.875rem;
      font-weight: 600;
      text-align: center;
    }
    .status-pending {
      background-color: #FEF3C7;
      color: #92400E;
    }
    .status-processing {
      background-color: #DBEAFE;
      color: #1E3A8A;
    }
    .status-completed {
      background-color: #D1FAE5;
      color: #065F46;
    }
    .status-failed {
      background-color: #FEE2E2;
      color: #991B1B;
    }
    .status-duplicate {
      background-color: #E5E7EB;
      color: #374151;
    }
    
    /* Action buttons */
    .action-btn {
      color: #3182ce;
      cursor: pointer;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      background: none;
      border: none;
      display: inline-flex;
      align-items: center;
      margin-right: 0.5rem;
    }
    .action-btn:hover {
      background-color: #bee3f8;
    }
    .action-btn.delete {
      color: #e53e3e;
    }
    .action-btn.delete:hover {
      background-color: #fed7d7;
    }
    
    /* Filters section */
    .filters-section {
      background-color: #f7fafc;
      padding: 1.5rem;
      border-radius: 0.5rem;
      margin-bottom: 1.5rem;
    }
    .filter-group {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      align-items: flex-end;
    }
    .filter-item {
      flex: 1;
      min-width: 200px;
    }
    .filter-item label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #2d3748;
    }
    .filter-item input,
    .filter-item select {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #cbd5e0;
      border-radius: 0.25rem;
    }
    .filter-item button {
      padding: 0.5rem 1rem;
      background-color: #3182ce;
      color: white;
      border: none;
      border-radius: 0.25rem;
      cursor: pointer;
      font-weight: 600;
    }
    .filter-item button:hover {
      background-color: #2c5aa0;
    }
    .filter-item button.clear {
      background-color: #718096;
    }
    .filter-item button.clear:hover {
      background-color: #4a5568;
    }
    
    /* Pagination */
    .pagination {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 1.5rem;
      padding-top: 1rem;
      border-top: 1px solid #e2e8f0;
    }
    .pagination-info {
      color: #4a5568;
    }
    .pagination-buttons {
      display: flex;
      gap: 0.5rem;
    }
    .pagination-button {
      padding: 0.5rem 1rem;
      border: 1px solid #cbd5e0;
      background-color: white;
      border-radius: 0.25rem;
      cursor: pointer;
      color: #2d3748;
    }
    .pagination-button:hover:not(:disabled) {
      background-color: #edf2f7;
    }
    .pagination-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .pagination-button.active {
      background-color: #3182ce;
      color: white;
      border-color: #3182ce;
    }
    
    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background-color: white;
      border-radius: 0.5rem;
      padding: 2rem;
      max-width: 800px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .modal-title {
      font-size: 1.25rem;
      font-weight: bold;
      margin-bottom: 1rem;
    }
    .modal-buttons {
      display: flex;
      justify-content: flex-end;
      margin-top: 1.5rem;
      gap: 0.75rem;
    }
    .modal-btn {
      padding: 0.5rem 1rem;
      border-radius: 0.25rem;
      border: none;
      cursor: pointer;
    }
    .modal-btn-cancel {
      background-color: #e2e8f0;
    }
    .modal-btn-cancel:hover {
      background-color: #cbd5e0;
    }
    .modal-btn-delete {
      background-color: #e53e3e;
      color: white;
    }
    .modal-btn-delete:hover {
      background-color: #c53030;
    }
    
    .error-message {
      background-color: #FEE2E2;
      border: 1px solid #F87171;
      color: #B91C1C;
      padding: 1rem;
      border-radius: 0.25rem;
      margin-bottom: 1rem;
    }
  </style>
{% endblock %}

{% block content %}
<!-- Drop overlay -->
<div id="dropOverlay" class="drop-overlay">
  <div class="drop-message">
    <i class="fas fa-cloud-upload-alt"></i>
    <p>Drop files anywhere to upload</p>
    <div class="drop-hint">Supports PDF, Office docs, images, and more</div>
  </div>
</div>

<!-- Upload progress modal -->
<div id="uploadModal" class="upload-modal">
  <div class="upload-modal-header">
    <span><i class="fas fa-upload"></i> Uploading Files</span>
    <button class="close-modal-btn" onclick="closeUploadModal()">
      <i class="fas fa-times"></i>
    </button>
  </div>
  <div class="upload-modal-body">
    <div id="uploadStatusMessage" class="text-sm text-gray-700 mb-2"></div>
    <div id="uploadProgressContainer" class="space-y-2"></div>
  </div>
</div>

<div class="container mx-auto px-4 py-8">
  <h2 class="text-3xl font-bold mb-6">File Records</h2>
  
  {% if error %}
  <div class="error-message">
    <p><strong>Error:</strong> {{ error }}</p>
    <p class="mt-2">This might be due to a configuration or import issue. Please check the server logs.</p>
  </div>
  {% endif %}

  <!-- Filters Section -->
  <div class="filters-section">
    <form method="get" action="/files" class="filter-group">
      <div class="filter-item">
        <label for="search">Search Filename</label>
        <input type="text" id="search" name="search" value="{{ search }}" placeholder="Enter filename...">
      </div>
      
      <div class="filter-item">
        <label for="mime_type">MIME Type</label>
        <select id="mime_type" name="mime_type">
          <option value="">All Types</option>
          {% for mt in mime_types %}
          <option value="{{ mt }}" {% if mt == mime_type %}selected{% endif %}>{{ mt }}</option>
          {% endfor %}
        </select>
      </div>
      
      <div class="filter-item">
        <label for="status">Status</label>
        <select id="status" name="status">
          <option value="">All Statuses</option>
          <option value="pending" {% if status == "pending" %}selected{% endif %}>Pending</option>
          <option value="processing" {% if status == "processing" %}selected{% endif %}>Processing</option>
          <option value="completed" {% if status == "completed" %}selected{% endif %}>Completed</option>
          <option value="failed" {% if status == "failed" %}selected{% endif %}>Failed</option>
          <option value="duplicate" {% if status == "duplicate" %}selected{% endif %}>Duplicate</option>
        </select>
      </div>
      
      <div class="filter-item">
        <label>&nbsp;</label>
        <button type="submit">Apply Filters</button>
      </div>
      
      <div class="filter-item">
        <label>&nbsp;</label>
        <button type="button" class="clear" onclick="clearFilters()">Clear</button>
      </div>
      
      <!-- Hidden fields to preserve sort order -->
      <input type="hidden" name="sort_by" value="{{ sort_by }}">
      <input type="hidden" name="sort_order" value="{{ sort_order }}">
      <input type="hidden" name="per_page" value="{{ pagination.per_page }}">
    </form>
  </div>
  
  <!-- Bulk Actions Section -->
  <div id="bulkActionsBar" class="filters-section" style="display: none; background-color: #e6f3ff;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <div>
        <strong id="selectedCount">0</strong> files selected
      </div>
      <div style="display: flex; gap: 1rem;">
        <button type="button" onclick="bulkReprocess()" style="padding: 0.5rem 1rem; background-color: #3182ce; color: white; border: none; border-radius: 0.25rem; cursor: pointer; font-weight: 600;">
          <i class="fas fa-sync"></i> Reprocess Selected
        </button>
        <button type="button" onclick="bulkDelete()" style="padding: 0.5rem 1rem; background-color: #e53e3e; color: white; border: none; border-radius: 0.25rem; cursor: pointer; font-weight: 600;">
          <i class="fas fa-trash"></i> Delete Selected
        </button>
        <button type="button" onclick="clearSelection()" style="padding: 0.5rem 1rem; background-color: #718096; color: white; border: none; border-radius: 0.25rem; cursor: pointer; font-weight: 600;">
          Clear Selection
        </button>
      </div>
    </div>
  </div>
  
  <!-- File table -->
  <div class="overflow-x-auto">
    <table class="file-table" id="fileTable">
      <thead>
        <tr>
          <th style="width: 40px;">
            <input type="checkbox" id="selectAll" onclick="toggleSelectAll()" title="Select all files on this page">
          </th>
          <th class="sortable" onclick="sortTable('id')">
            ID
            <span class="sort-indicator {% if sort_by == 'id' %}active{% endif %}">
              {% if sort_by == 'id' %}
                {% if sort_order == 'asc' %}▲{% else %}▼{% endif %}
              {% else %}
                ↕
              {% endif %}
            </span>
          </th>
          <th class="sortable" onclick="sortTable('original_filename')">
            Original Filename
            <span class="sort-indicator {% if sort_by == 'original_filename' %}active{% endif %}">
              {% if sort_by == 'original_filename' %}
                {% if sort_order == 'asc' %}▲{% else %}▼{% endif %}
              {% else %}
                ↕
              {% endif %}
            </span>
          </th>
          <th class="sortable" onclick="sortTable('file_size')">
            File Size
            <span class="sort-indicator {% if sort_by == 'file_size' %}active{% endif %}">
              {% if sort_by == 'file_size' %}
                {% if sort_order == 'asc' %}▲{% else %}▼{% endif %}
              {% else %}
                ↕
              {% endif %}
            </span>
          </th>
          <th class="sortable" onclick="sortTable('mime_type')">
            MIME Type
            <span class="sort-indicator {% if sort_by == 'mime_type' %}active{% endif %}">
              {% if sort_by == 'mime_type' %}
                {% if sort_order == 'asc' %}▲{% else %}▼{% endif %}
              {% else %}
                ↕
              {% endif %}
            </span>
          </th>
          <th>Status</th>
          <th class="sortable" onclick="sortTable('created_at')">
            Created At
            <span class="sort-indicator {% if sort_by == 'created_at' %}active{% endif %}">
              {% if sort_by == 'created_at' %}
                {% if sort_order == 'asc' %}▲{% else %}▼{% endif %}
              {% else %}
                ↕
              {% endif %}
            </span>
          </th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for file in files %}
        <tr onclick="viewFileDetail({{ file.id }}, event)">
          <td onclick="event.stopPropagation();">
            <input type="checkbox" class="file-checkbox" value="{{ file.id }}" onchange="updateBulkActionsBar()">
          </td>
          <td>{{ file.id }}</td>
          <td>{{ file.original_filename }}</td>
          <td>{{ (file.file_size / 1024) | round(2) }} KB</td>
          <td>{{ file.mime_type }}</td>
          <td>
            <span class="status-badge status-{{ file.processing_status }}">
              {{ file.processing_status | title }}
            </span>
          </td>
          <td>{{ file.created_at.strftime('%Y-%m-%d %H:%M:%S') if file.created_at else 'N/A' }}</td>
          <td>
            <div style="display: flex; align-items: center;">
              <button onclick="viewFileDetail({{ file.id }}, event)" class="action-btn" title="View details">
                <i class="fas fa-info-circle"></i>
              </button>
              <button onclick="showDeleteModal({{ file.id }}, event)" class="action-btn delete" title="Delete file">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="8" class="text-center py-4">No files found</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  
  <!-- Pagination -->
  {% if pagination.total_pages > 1 %}
  <div class="pagination">
    <div class="pagination-info">
      Showing {{ ((pagination.page - 1) * pagination.per_page + 1) }} - 
      {{ min(pagination.page * pagination.per_page, pagination.total_items) }} 
      of {{ pagination.total_items }} files
    </div>
    <div class="pagination-buttons">
      {% if pagination.page > 1 %}
      <button class="pagination-button" onclick="goToPage(1)">First</button>
      <button class="pagination-button" onclick="goToPage({{ pagination.page - 1 }})">Previous</button>
      {% endif %}
      
      {% for p in range(max(1, pagination.page - 2), min(pagination.total_pages + 1, pagination.page + 3)) %}
      <button class="pagination-button {% if p == pagination.page %}active{% endif %}" onclick="goToPage({{ p }})">
        {{ p }}
      </button>
      {% endfor %}
      
      {% if pagination.page < pagination.total_pages %}
      <button class="pagination-button" onclick="goToPage({{ pagination.page + 1 }})">Next</button>
      <button class="pagination-button" onclick="goToPage({{ pagination.total_pages }})">Last</button>
      {% endif %}
    </div>
  </div>
  {% endif %}
  
  <!-- Delete confirmation modal -->
  <div id="deleteModal" class="modal">
    <div class="modal-content">
      <div class="modal-title">Confirm Deletion</div>
      <p>Are you sure you want to delete this file?</p>
      <div class="modal-buttons">
        <button id="cancelDelete" class="modal-btn modal-btn-cancel">Cancel</button>
        <button id="confirmDelete" class="modal-btn modal-btn-delete">Delete</button>
      </div>
    </div>
  </div>
  
  <script>
    // Modal functionality
    const deleteModal = document.getElementById('deleteModal');
    const cancelDelete = document.getElementById('cancelDelete');
    const confirmDelete = document.getElementById('confirmDelete');
    let currentFileId = null;
    
    function showDeleteModal(fileId, event) {
      if (event) event.stopPropagation();
      currentFileId = fileId;
      deleteModal.style.display = 'flex';
    }
    
    function viewFileDetail(fileId, event) {
      if (event) event.stopPropagation();
      window.location.href = `/files/${fileId}/detail`;
    }
    
    cancelDelete.addEventListener('click', () => {
      deleteModal.style.display = 'none';
    });
    
    confirmDelete.addEventListener('click', () => {
      deleteFile(currentFileId);
      deleteModal.style.display = 'none';
    });
    
    // Close modal if clicking outside of it
    window.addEventListener('click', (event) => {
      if (event.target === deleteModal) {
        deleteModal.style.display = 'none';
      }
    });
    
    function deleteFile(fileId) {
      fetch(`/api/files/${fileId}`, {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json'
        }
      })
      .then(response => {
        if (!response.ok) {
          // Try to parse JSON error response, but handle non-JSON gracefully
          const contentType = response.headers.get('content-type');
          if (contentType && contentType.includes('application/json')) {
            return response.json().then(err => {
              throw new Error(err.detail || 'Failed to delete file');
            });
          } else {
            // Non-JSON response (likely HTML error page)
            return response.text().then(text => {
              // Extract a readable error message
              const statusText = response.statusText || 'Error';
              throw new Error(`${statusText} (${response.status}): Server returned non-JSON response`);
            });
          }
        }
        return response.json();
      })
      .then(data => {
        // Reload the page to show updated file list
        window.location.reload();
      })
      .catch(error => {
        console.error('Error:', error);
        alert(`Error deleting file: ${error.message}`);
      });
    }
    
    function sortTable(column) {
      const urlParams = new URLSearchParams(window.location.search);
      const currentSortBy = urlParams.get('sort_by') || 'created_at';
      const currentSortOrder = urlParams.get('sort_order') || 'desc';
      
      // Toggle sort order if clicking the same column
      let newSortOrder = 'asc';
      if (column === currentSortBy) {
        newSortOrder = currentSortOrder === 'asc' ? 'desc' : 'asc';
      }
      
      urlParams.set('sort_by', column);
      urlParams.set('sort_order', newSortOrder);
      urlParams.set('page', '1'); // Reset to first page on sort
      
      window.location.search = urlParams.toString();
    }
    
    function goToPage(page) {
      const urlParams = new URLSearchParams(window.location.search);
      urlParams.set('page', page);
      window.location.search = urlParams.toString();
    }
    
    function clearFilters() {
      window.location.href = '/files';
    }
    
    // Bulk selection functionality
    function toggleSelectAll() {
      const selectAll = document.getElementById('selectAll');
      const checkboxes = document.querySelectorAll('.file-checkbox');
      checkboxes.forEach(checkbox => {
        checkbox.checked = selectAll.checked;
      });
      updateBulkActionsBar();
    }
    
    function updateBulkActionsBar() {
      const checkboxes = document.querySelectorAll('.file-checkbox:checked');
      const selectedCount = checkboxes.length;
      const bulkActionsBar = document.getElementById('bulkActionsBar');
      const selectedCountEl = document.getElementById('selectedCount');
      
      if (selectedCount > 0) {
        bulkActionsBar.style.display = 'block';
        selectedCountEl.textContent = selectedCount;
      } else {
        bulkActionsBar.style.display = 'none';
      }
      
      // Update "select all" checkbox state
      const allCheckboxes = document.querySelectorAll('.file-checkbox');
      const selectAll = document.getElementById('selectAll');
      selectAll.checked = allCheckboxes.length > 0 && selectedCount === allCheckboxes.length;
    }
    
    function clearSelection() {
      document.querySelectorAll('.file-checkbox').forEach(cb => cb.checked = false);
      document.getElementById('selectAll').checked = false;
      updateBulkActionsBar();
    }
    
    function getSelectedFileIds() {
      const checkboxes = document.querySelectorAll('.file-checkbox:checked');
      return Array.from(checkboxes).map(cb => parseInt(cb.value));
    }
    
    function bulkDelete() {
      const fileIds = getSelectedFileIds();
      if (fileIds.length === 0) {
        alert('Please select files to delete');
        return;
      }
      
      if (!confirm(`Are you sure you want to delete ${fileIds.length} file(s)?`)) {
        return;
      }
      
      fetch('/api/files/bulk-delete', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(fileIds)
      })
      .then(response => {
        if (!response.ok) {
          return response.json().then(err => {
            throw new Error(err.detail || 'Failed to delete files');
          });
        }
        return response.json();
      })
      .then(data => {
        alert(data.message);
        window.location.reload();
      })
      .catch(error => {
        console.error('Error:', error);
        alert(`Error deleting files: ${error.message}`);
      });
    }
    
    function bulkReprocess() {
      const fileIds = getSelectedFileIds();
      if (fileIds.length === 0) {
        alert('Please select files to reprocess');
        return;
      }
      
      if (!confirm(`Are you sure you want to reprocess ${fileIds.length} file(s)?`)) {
        return;
      }
      
      fetch('/api/files/bulk-reprocess', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(fileIds)
      })
      .then(response => {
        if (!response.ok) {
          return response.json().then(err => {
            throw new Error(err.detail || 'Failed to reprocess files');
          });
        }
        return response.json();
      })
      .then(data => {
        if (data.errors && data.errors.length > 0) {
          const errorMsg = data.errors.map(e => `${e.filename}: ${e.error}`).join('\n');
          alert(`${data.message}\n\nErrors:\n${errorMsg}`);
        } else {
          alert(data.message);
        }
        clearSelection();
        window.location.reload();
      })
      .catch(error => {
        console.error('Error:', error);
        alert(`Error reprocessing files: ${error.message}`);
      });
    }
    
    // ===== Drag-and-Drop Upload Functionality =====
    const dropOverlay = document.getElementById('dropOverlay');
    const uploadModal = document.getElementById('uploadModal');
    const uploadStatusMessage = document.getElementById('uploadStatusMessage');
    const uploadProgressContainer = document.getElementById('uploadProgressContainer');
    
    let dragCounter = 0; // Track nested drag events
    
    // Show overlay when dragging files over the window
    window.addEventListener('dragenter', (e) => {
      e.preventDefault();
      dragCounter++;
      
      // Only show overlay if dragging files
      if (e.dataTransfer.types.includes('Files')) {
        dropOverlay.classList.add('active');
      }
    });
    
    window.addEventListener('dragleave', (e) => {
      e.preventDefault();
      dragCounter--;
      
      if (dragCounter === 0) {
        dropOverlay.classList.remove('active');
      }
    });
    
    window.addEventListener('dragover', (e) => {
      e.preventDefault();
      e.dataTransfer.dropEffect = 'copy';
    });
    
    window.addEventListener('drop', (e) => {
      e.preventDefault();
      dragCounter = 0;
      dropOverlay.classList.remove('active');
      
      if (e.dataTransfer.files.length > 0) {
        // Show upload modal
        uploadModal.classList.add('active');
        uploadProgressContainer.innerHTML = '';
        
        // Process the dropped files
        processFiles(e.dataTransfer.files, uploadProgressContainer, uploadStatusMessage);
      }
    });
    
    // Listen for upload completion event and reload the page to show new files
    window.addEventListener('allUploadsComplete', (e) => {
      // Wait 2 seconds to let users see the success message
      setTimeout(() => {
        window.location.reload();
      }, 2000);
    });
    
    function closeUploadModal() {
      uploadModal.classList.remove('active');
    }
  </script>
</div>
{% endblock %}
